<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FX & Metals — Market Insights</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/static/styles.css" rel="stylesheet" />
  </head>
  <body data-bs-theme="dark" class="bg-dark">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark glass shadow-strong">
      <div class="container-fluid">
        <a class="navbar-brand brand-center brand-lg" href="#">Market Insights</a>
        <ul class="navbar-nav ms-auto nav-pills minimal-tabs">
          <li class="nav-item"><button id="tab-dashboard-btn" class="nav-link active" type="button">Dashboard</button></li>
          <li class="nav-item"><button id="tab-journal-btn" class="nav-link" type="button">Journal</button></li>
          <li class="nav-item"><button id="tab-wealth-btn" class="nav-link" type="button">Wealth</button></li>
        </ul>
      </div>
    </nav>

    <main class="container py-4">
      <!-- Dashboard Tab -->
      <section id="tab-dashboard">
      <div id="insights-alert" class="alert alert-warning d-none glass" role="alert">
        GPT insights are disabled. Set OPENAI_API_KEY in your .env and restart the server, then click "Ask GPT".
        <button type="button" class="btn-close float-end" aria-label="Close" id="insights-alert-close"></button>
      </div>
  <h1 class="h3 mb-3 page-title text-center">FX & Precious Metals Dashboard</h1>
      <div class="row g-4">
        <!-- Watchlist -->
        <section class="col-12 col-lg-4">
          <div class="card glass shadow-strong h-100">
            <div class="card-header glass-header d-flex align-items-center justify-content-between">
              <span>Watchlist</span>
              <div class="form-check form-switch small">
                <input class="form-check-input" type="checkbox" id="autorefresh" />
                <label class="form-check-label" for="autorefresh">Auto</label>
              </div>
            </div>
            <div class="card-body p-0 d-flex flex-column">
              <div class="p-3">
                <div class="row g-2 align-items-center">
                  <div class="col-12">
                    <div class="input-group">
                      <input id="add-symbol" class="form-control" placeholder="Add symbol (e.g., EURUSD, XAUUSD)" />
                      <button id="add-symbol-btn" class="btn btn-outline-primary">Add</button>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="input-group">
                      <select id="preset-symbol" class="form-select">
                        <!-- options filled by JS -->
                      </select>
                      <button id="add-preset-btn" class="btn btn-outline-secondary">Add from list</button>
                    </div>
                  </div>
                </div>
                <div class="form-text mt-2">Use the dropdown for majors/metals, or type your own. Drag to reorder; click to open.</div>
              </div>
              <div class="watchlist-scroll px-2 pb-2">
                <ul id="watchlist" class="list-group list-group-flush small watchlist"></ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Quote -->
        <section class="col-12 col-lg-8">
          <div class="card glass shadow-strong mb-4">
            <div class="card-header glass-header d-flex align-items-center gap-2">Last Quote <span class="small text-muted" id="selected-symbol">—</span></div>
            <div class="card-body" id="quote-card">
              <div class="text-muted">Select a symbol</div>
            </div>
          </div>
        </section>
      </div>

      <!-- News and calendar -->
      <div class="row g-4 mt-1">
        <section class="col-12">
          <div class="row g-4 mt-1">
            <div class="col-12 col-lg-6">
              <div class="card glass shadow-strong h-100">
                <div class="card-header glass-header d-flex align-items-center">News <span class="small text-muted ms-2" id="news-caption"></span></div>
                <div class="card-body">
                  <ul id="news-list" class="list-unstyled small mb-0"></ul>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6">
              <div class="card glass shadow-strong h-100">
                <div class="card-header glass-header">Macro Calendar</div>
                <div class="card-body">
                  <ul id="calendar-list" class="list-unstyled small mb-0"></ul>
                </div>
              </div>
            </div>
          </div>

          <div class="row g-4 mt-1">
            <div class="col-12 col-lg-6">
              <div class="card glass shadow-strong h-100">
                <div class="card-header glass-header d-flex align-items-center gap-2">
                  <span>Analyses</span>
                  <div class="ms-auto d-flex gap-2 align-items-center">
                    <select id="insights-horizon" class="form-select form-select-sm" style="width:auto">
                      <option value="daily" selected>Daily</option>
                      <option value="weekly">Weekly</option>
                    </select>
                    <button id="insights-refresh" class="btn btn-sm btn-outline-info">Ask GPT</button>
                  </div>
                </div>
                <div class="card-body">
                  <div id="analysis-content" class="small text-body-emphasis" style="white-space:pre-wrap"></div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6">
              <div class="card glass shadow-strong h-100">
                <div class="card-header glass-header d-flex align-items-center gap-2">
                  <span>Entry Plan</span>
                  <div class="ms-auto">
                    <button id="plan-generate" class="btn btn-sm btn-outline-warning">Generate Plan</button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="mb-2 d-flex flex-wrap gap-2 align-items-center">
                    <label for="plan-images" class="form-label m-0 small">Screenshots</label>
                    <input id="plan-images" class="form-control form-control-sm" type="file" accept="image/*" multiple style="max-width:280px" />
                    <button id="plan-images-clear" class="btn btn-sm btn-outline-danger" type="button">Clear</button>
                    <button id="plan-generate-vision" class="btn btn-sm btn-outline-info">Generate from screenshots (ICT)</button>
                    <span class="text-muted small">Up to 5 images. Use marked-up charts for best results.</span>
                  </div>
                  <div id="plan-image-previews" class="d-flex flex-wrap gap-2 mb-3"></div>
                  <div id="entry-plan" class="small" style="white-space:pre-wrap"></div>
                  <hr class="my-3" />
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <span class="small text-muted">History</span>
                    <button id="plan-history-refresh" class="btn btn-sm btn-outline-secondary">Refresh</button>
                    <button id="plan-history-expand-all" class="btn btn-sm btn-outline-secondary">Expand all</button>
                    <button id="plan-history-collapse-all" class="btn btn-sm btn-outline-secondary">Collapse all</button>
                  </div>
                  <ul id="entry-plan-history" class="list-group small"></ul>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      </section>

  <!-- Journal Tab -->
      <section id="tab-journal" class="d-none">
        <h1 class="h3 mb-3 page-title text-center">Trade Journal</h1>
        <div class="row g-4">
          <div class="col-12 col-lg-4">
            <div class="card glass minimal-card">
              <div class="card-header glass-header">Log a Trade</div>
              <div class="card-body">
                <form id="j-form" class="row g-3">
                  <input type="hidden" id="j-id" />
                  <div class="col-6">
                    <label class="form-label" for="j-symbol">Symbol</label>
                    <input class="form-control" id="j-symbol" placeholder="e.g., EURUSD" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-date">Date</label>
                    <input class="form-control" id="j-date" type="datetime-local" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-direction">Direction</label>
                    <select class="form-select" id="j-direction">
                      <option value="Long">Long</option>
                      <option value="Short">Short</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-qty">Qty</label>
                    <input class="form-control" id="j-qty" type="number" step="any" placeholder="e.g., 1.0" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-entry">Entry</label>
                    <input class="form-control" id="j-entry" type="number" step="any" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-stop">Stop</label>
                    <input class="form-control" id="j-stop" type="number" step="any" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-exit">Exit</label>
                    <input class="form-control" id="j-exit" type="number" step="any" />
                  </div>
                  <div class="col-6">
                    <label class="form-label" for="j-fees">Fees</label>
                    <input class="form-control" id="j-fees" type="number" step="any" value="0" />
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="j-tags">Tags</label>
                    <input class="form-control" id="j-tags" placeholder="e.g., breakout, news, pullback" />
                  </div>
                  <div class="col-12">
                    <label class="form-label" for="j-notes">Notes</label>
                    <textarea class="form-control" id="j-notes" rows="3" placeholder="What was the setup? What did you see?"></textarea>
                  </div>
                  <div class="col-12 d-flex gap-2">
                    <button class="btn btn-primary" type="submit" id="j-save">Save</button>
                    <button class="btn btn-outline-secondary" type="button" id="j-reset">Reset</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-8">
            <div class="row g-3">
              <div class="col-12">
                <div class="card glass minimal-card">
                  <div class="card-header glass-header d-flex align-items-center">Overview <div class="ms-auto small text-muted" id="j-overview-caption"></div></div>
                  <div class="card-body">
                    <div class="row text-center">
                      <div class="col-6 col-md-3"><div class="stat"><div class="h4" id="j-stat-trades">0</div><div class="text-muted small">Trades</div></div></div>
                      <div class="col-6 col-md-3"><div class="stat"><div class="h4" id="j-stat-winrate">0%</div><div class="text-muted small">Win Rate</div></div></div>
                      <div class="col-6 col-md-3"><div class="stat"><div class="h4" id="j-stat-ravg">0.00</div><div class="text-muted small">Avg R</div></div></div>
                      <div class="col-6 col-md-3"><div class="stat"><div class="h4" id="j-stat-pnl">0.00</div><div class="text-muted small">Total PnL</div></div></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="card glass minimal-card">
                  <div class="card-header glass-header d-flex align-items-center gap-2">
                    <span>AI Review</span>
                    <div class="ms-auto d-flex gap-2 align-items-center flex-wrap">
                      <label class="form-label m-0 small">Scope</label>
                      <select id="j-ai-scope" class="form-select form-select-sm" style="width:auto">
                        <option value="filtered">Filtered view</option>
                        <option value="last20">Last 20 trades</option>
                        <option value="all">All trades</option>
                      </select>
                      <button id="j-ai-run" class="btn btn-sm btn-outline-info">Analyze Journal</button>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="mb-2">
                      <label class="form-label small" for="j-ai-notes">Focus (optional)</label>
                      <input class="form-control" id="j-ai-notes" placeholder="e.g., help me reduce overtrading and improve risk discipline" />
                    </div>
                    <div id="j-ai-output" class="small" style="white-space:pre-wrap"></div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-xl-6">
                <div class="card glass minimal-card h-100">
                  <div class="card-header glass-header">Equity Curve</div>
                  <div class="card-body"><canvas id="equity-chart" height="140"></canvas></div>
                </div>
              </div>
              <div class="col-12 col-xl-6">
                <div class="card glass minimal-card h-100">
                  <div class="card-header glass-header">PnL Distribution</div>
                  <div class="card-body"><canvas id="pnl-hist-chart" height="140"></canvas></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card glass minimal-card mt-4">
          <div class="card-header glass-header d-flex align-items-center gap-2">
            <span>Trades</span>
            <div class="ms-auto d-flex gap-2 flex-wrap">
              <input class="form-control form-control-sm" id="j-filter-symbol" placeholder="Symbol" style="width:110px" />
              <select class="form-select form-select-sm" id="j-filter-dir" style="width:110px">
                <option value="">All</option>
                <option value="Long">Long</option>
                <option value="Short">Short</option>
              </select>
              <input class="form-control form-control-sm" id="j-filter-start" type="date" />
              <input class="form-control form-control-sm" id="j-filter-end" type="date" />
              <input class="form-control form-control-sm" id="j-filter-tag" placeholder="Tag" style="width:120px" />
              <button class="btn btn-sm btn-outline-secondary" id="j-export">Export</button>
              <label class="btn btn-sm btn-outline-secondary mb-0">
                Import <input id="j-import" type="file" accept="application/json" hidden />
              </label>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm table-striped align-middle mb-0" id="j-trades-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Symbol</th>
                    <th>Dir</th>
                    <th>Entry</th>
                    <th>Stop</th>
                    <th>Exit</th>
                    <th>Qty</th>
                    <th>PnL</th>
                    <th>R</th>
                    <th>Tags</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Wealth Tab -->
      <section id="tab-wealth" class="d-none">
        <h1 class="h3 mb-3 page-title text-center">Wealth Management</h1>
        <div class="row g-4">
          <div class="col-12 col-xl-4">
            <div class="card glass minimal-card h-100">
              <div class="card-header glass-header">Portfolios</div>
              <div class="card-body">
                <form id="wm-portfolio-form" class="row g-2">
                  <input type="hidden" id="wm-portfolio-id" />
                  <div class="col-7"><input class="form-control" id="wm-portfolio-name" placeholder="Name"/></div>
                  <div class="col-5"><input class="form-control" id="wm-portfolio-base" placeholder="Base CCY (e.g., USD)"/></div>
                  <div class="col-12 d-flex gap-2">
                    <button class="btn btn-primary" id="wm-portfolio-save" type="submit">Save</button>
                  </div>
                </form>
                <ul id="wm-portfolio-list" class="list-unstyled mt-3 mb-0 small"></ul>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-8">
            <div class="card glass minimal-card">
              <div class="card-header glass-header d-flex align-items-center gap-2">Transactions <span class="ms-auto small text-muted" id="wm-portfolio-caption">—</span></div>
              <div class="card-body">
                <form id="wm-txn-form" class="row g-2">
                  <div class="col-3"><input class="form-control" id="wm-txn-date" type="date" /></div>
                  <div class="col-2"><input class="form-control" id="wm-txn-symbol" placeholder="Symbol"/></div>
                  <div class="col-2">
                    <select id="wm-txn-type" class="form-select">
                      <option value="BUY">BUY</option>
                      <option value="SELL">SELL</option>
                      <option value="DIV">DIV</option>
                      <option value="CASH">CASH</option>
                    </select>
                  </div>
                  <div class="col-2"><input class="form-control" id="wm-txn-qty" type="number" step="any" placeholder="Qty"/></div>
                  <div class="col-2"><input class="form-control" id="wm-txn-price" type="number" step="any" placeholder="Price"/></div>
                  <div class="col-1"><input class="form-control" id="wm-txn-fees" type="number" step="any" placeholder="Fees"/></div>
                  <div class="col-12"><input class="form-control" id="wm-txn-notes" placeholder="Notes"/></div>
                  <div class="col-12 d-flex gap-2"><button class="btn btn-primary" id="wm-txn-add" type="submit">Add</button></div>
                </form>
                <div class="table-responsive mt-3">
                  <table class="table table-sm table-striped align-middle mb-0" id="wm-txn-table">
                    <thead><tr><th>Date</th><th>Symbol</th><th>Type</th><th>Qty</th><th>Price</th><th>Fees</th><th></th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="card glass minimal-card mt-3">
              <div class="card-header glass-header">Positions</div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm table-striped align-middle mb-0" id="wm-pos-table">
                    <thead><tr><th>Symbol</th><th>Qty</th><th>Avg Cost</th><th>Last</th><th>Market Value</th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

  <!-- Vendor: Chart.js for Journal charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="/static/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
